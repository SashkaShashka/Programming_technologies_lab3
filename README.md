# Технологии программирования ЛР3 Вариант 18
Выполнили студенты группы 6407 Одобеску Роман и Андреев Александр
### Задание к ЛР3
Добавьте в свой предыдущий проект возможность сохранения состояния в виде периодического сохранения, либо в виде функций импорта и экспорта. Выбранный формат для сериализации должен иметь схему. В проекте обязателен код валидирующий данные. Валидация должна производиться либо в программе при импорте данных, либо в юнит-тестах, проверяющих корректность сохранения состояния.
### Описание работы
В данной ЛР созданы два файла Server и Client. Сервер контроллирует взаимодействия двух клиентов (игроков) и ведет "общение" с ними посредством пересылки JSON файлов, а так же он отвечает за реализацию самой игры. Сначала запускается Server, далее он ожидает подключение игроков. После их подключения ожидает от них выбор действия (камень/ножницы/бумага). Далее он получает выбор игроков и отправляет результат игрокам об их выигрыше, проигрыше или ничье, а так же дублирует это у себя. После этого игра заканчивается.

В третьей лабораторной работе добавлена возможность сохранения состояния игры. Это помогает восстанавливать игру при падении сервера. Сохранения производятся в виде json файла server_state.json, его корректность проверяется с помощью 6 схем, каждая из которых соответствует определенной ситуации. Согласно концепции игры, написанной во 2 ЛР, клиенты характеризуются именем сокета, поэтому если клиент отключился, то подключиться заново он уже не сможет, так как ему будет присвоен другой номер сокета.
При начале новой игры на сервере файл server_state должен отсутствовать. При не соответствии файла ни одной из 6 схем на сервере появится сообщение о том, что сохранения повреждены и произойдет запуск новой игры.

Файл server_state хранит в себе информацию о клиентах: имя клиента (client0 или client1), его статус ("disconnected", "не принят ответ",("камень","ножницы","бумага")), адрес и сокет. На обоих сторонах реализован timeout подключения: (Client) если не удалось переподключиться к серверу в течение 10 секунд, клиент узнает об этом и игра для него завершается; (Server) при возобновлении работы сервера если не удается подключиться к клиенту в течение 10 секунд, он считается отключенным от сервера. Если оба клиента отключены от сервера, игра прекращается и в при следующем запуске начнется новая игра. Каждый запуск сервера рассчитан на 1 игру или на продолжение прошлой игры.

Работа была выполнена на языке Python.

На изображении ниже представлена реализация схемы 0, при которой начинается новая игра

![image](https://user-images.githubusercontent.com/62326372/146595741-e40c840b-b4cf-483d-a76e-d6f5dea78342.png)

На изображении ниже представлена реализация схем 1 и 2, при которых один из игроков был отсоединён до отключения сервера, а после его повторного запуска игра продолжилась с одним игроком. Со стороны наблюдателя разницы нет, кто отсоединился. Разница есть только для серверва, так как он записывает кто из игроков отсоединился, соотвественно, это можно увидеть по схемам 1 и 2.

![image](https://user-images.githubusercontent.com/62326372/146594687-426ff883-13dc-4025-bc2f-662521a1beac.png)

![image](https://user-images.githubusercontent.com/62326372/146593132-a8369c98-4132-4efa-afdc-cf243ce9f9b1.png)

На изображении ниже представлена реализация схемы 3, при которой оба игрока ждут повторного запуска сервера и игра продолжается нормальным образом. Стоит заметить, что из схемы 3 можно перейти в схемы номер 4 и 5.

![image](https://user-images.githubusercontent.com/62326372/146575454-c9da8392-4314-4cb9-873c-92260ee0e631.png)

На изображении ниже представлена реализации схем 4 и 5, при которых один из игроков сделал ход до отключения сервера, затем, после повторного включения сервера, другой игрок вводит свой ход и игра завершается. Разница в данном случае также существенна только для сервера; ему важно, кто именно отправил корректный ответ.

![image](https://user-images.githubusercontent.com/62326372/146595592-2054a429-91b5-4ffc-91d0-002738547e49.png)

Стоит заметить, что в данной версии считается, что сервер может упасть только в моменты ввода игроком своего хода, т.е. при ситуации, когда оба игрока ввели свои корректные ходы, считается, что сервер обрабатывает их ходы мгновенно и так же мгновенно отправляет им ответы о ходе противника и результатах игры
